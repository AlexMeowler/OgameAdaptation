<ng-template #resourceCost
             let-cost="resource"
             let-resName="name"
             let-stock="planetStock">
    <span *ngIf="cost.amount > 0">{{ resName }}: <b style="color: {{  getColor(hasResource(cost, stock)) }}">{{ cost.amount | customNumber }}&nbsp;</b></span>
</ng-template>
<ng-template #resourceRemaining
             let-cost="resource"
             let-resName="name"
             let-stock="planetStock">
    <span *ngIf="cost.amount > 0">{{ resName }}: <b style="color: color-mix(in xyz, gray 100%, {{  getColor(stock.amount - cost.amount >= 0) }} 20%)">{{ stock.amount - cost.amount | customNumber }}&nbsp;</b></span>
</ng-template>
<div style="text-align: center">
    <table width="750">
        <tbody>
        <tr *ngFor="let order of buildingOrders; let i = index">
            <td class="l" colspan="2">{{ i + 1 }}.: {{order.name}} {{order.value}}</td>
            <td class="k">
                <div class="x">
                    {{order.timeLeft | duration:':'}}<br>
                    <a href="javascript:void(0);" (click)="deleteOrder(order.id)">Отменить</a>
                </div>
                <strong style="color: lime"><br>{{ order.endTimeDate | date:'dd/MM HH:mm:ss' }}</strong>
            </td>
        </tr>
        <tr *ngFor="let obj of buildingInstances">
            <td class="l">
                <a routerLink="/buildings/{{ obj.building.id }}">
                    <img border="0" ngSrc="/img/building/{{ obj.building.imageName }}" align="top" width="120" height="120" alt="{{ obj.building.name }}">
                </a>
            </td>
            <td class="l">
                <span><a routerLink="/buildings/{{ obj.building.id }}">{{ obj.building.name }}</a>&nbsp;</span>
                <span *ngIf="obj.level > 0">(Уровень {{ obj.level }}) </span>
                <div *ngIf="obj.energyDiff != 0" style="display: inline-block">(<div style="color: {{ getColor(obj.energyDiff > 0) }}; display: inline-block" text-tooltip tooltipText="{{ obj.energyDiff > 0 ? ENERGY_DIFF_POSITIVE_TOOLTIP : ENERGY_DIFF_NEGATIVE_TOOLTIP}}">{{ obj.energyDiff | customNumber:true }} Энергия</div>)</div><br>
                {{ obj.building.shortDescription }}<br>
                Необходимые ресурсы:
                <ng-container *ngTemplateOutlet="resourceCost;context:{
                        resource:obj.buildingCost.metal,
                        planetStock:resources.metal,
                        name:'Металл'
                    }"/>
                <ng-container *ngTemplateOutlet="resourceCost;context:{
                        resource:obj.buildingCost.crystal,
                        planetStock:resources.crystal,
                        name:'Кристалл',
                    }"/>
                <ng-container *ngTemplateOutlet="resourceCost;context:{
                        resource:obj.buildingCost.deuterium,
                        planetStock:resources.deuterium,
                        name:'Дейтерий'
                    }"/>
                <ng-container *ngTemplateOutlet="resourceCost;context:{
                        resource:obj.buildingCost.energy,
                        planetStock:resources.energy,
                        name:'Энергия'
                    }"/>
                <br>Время строительства: {{ obj.buildingTime | duration }}
                <div style="color: gray">Останется ресурсов:
                    <ng-container *ngTemplateOutlet="resourceRemaining;context:{
                            resource:obj.buildingCost.metal,
                            planetStock:resources.metal,
                            name:'Металл'
                        }"/>
                    <ng-container *ngTemplateOutlet="resourceRemaining;context:{
                            resource:obj.buildingCost.crystal,
                            planetStock:resources.crystal,
                            name:'Кристалл',
                        }"/>
                    <ng-container *ngTemplateOutlet="resourceRemaining;context:{
                            resource:obj.buildingCost.deuterium,
                            planetStock:resources.deuterium,
                            name:'Дейтерий'
                        }"/>
                    <ng-container *ngTemplateOutlet="resourceRemaining;context:{
                            resource:obj.buildingCost.energy,
                            planetStock:resources.energy,
                            name:'Энергия'
                        }"/><br>
                </div>
            </td>
            <td class="k" width="76">
                <ng-container *ngIf="obj.requirements.length === 0">
                    <span *ngIf="!canBuild(obj)" style="color: red">Недостаточно ресурсов!</span>
                    <a *ngIf="canBuild(obj)" style="color: lime" href="javascript:void(0);" (click)="createOrder(obj.building.id)">
                        {{ buildingOrders.length === 0 ? 'Построить' + (obj.level !== 0 ? ' следующий уровень ' + (obj.level + 1) : '') : 'В очередь построек' }}
                    </a>
                </ng-container>
                <ng-container *ngIf="obj.requirements.length !== 0">
                    <div>
                        <ng-container *ngFor="let req of obj.requirements">
                            <div class="el-require" routerLink="/{{ req.detailsPath }}" text-tooltip tooltipText="Требуется: {{ req.name }} {{ req.requiredLevel }} уровня (у Вас {{ req.currentLevel }})">
                                <a>
                                    <img border="0" ngSrc="/img/{{ req.imagePath }}" align="top" width="32" height="32" alt="{{ req.name }}"/>
                                </a>
                                <div class="el-require-block">
                                    <div class="el-require-skos"></div>
                                    <div class="el-require-bg"><span style="color:red">{{ req.currentLevel }}/{{ req.requiredLevel }}</span></div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
            </td>
        </tr>
        </tbody>
    </table>
</div>